<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Saturday, March 25, 2017, 1:44 PM -->
<!-- MuClient version 5.06-pre -->

<!-- Plugin "TempPortalMaker" generated by Plugin Wizard -->

<muclient>
<plugin
   name="TempPortalMaker"
   author="Sonet"
   id="f14c91a19af9f62f1fdab4e1"
   language="Lua"
   save_state="y"
   date_written="2017-03-25 13:43:27"
   requires="4.50"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Aliases  -->

<aliases>
  <alias
   match="^homePortal\s?(.*?)?$"
   enabled="y"
   group="special_convenience_aliases"
   regexp="y"
   script="portal_handle"
   sequence="100"
  >
  </alias>
  <alias
   match="^TPM help$"
   enabled="y"
   group="special_convenience_aliases"
   regexp="y"
   script="help"
   sequence="100"
  >
  </alias>
  <alias
   match="^petPortal\s(.*?)$"
   enabled="y"
   group="special_convenience_aliases"
   regexp="y"
   script="portal_handle_pet"
   sequence="100"
  >
  </alias>
  <alias
   match="^clearPortals$"
   enabled="y"
   group="special_convenience_aliases"
   regexp="y"
   script="clearPortals"
   sequence="100"
  >
  </alias>
  <alias
   match="^clearPetPortal$"
   enabled="y"
   group="special_convenience_aliases"
   regexp="y"
   script="clearPortalPet"
   sequence="100"
  >
  </alias>
  <alias
   match="^clearHomePortal$"
   enabled="y"
   group="special_convenience_aliases"
   regexp="y"
   script="clearPortalHome"
   sequence="100"
  >
  </alias>
</aliases>

<!--  Script  -->


<script>
<![CDATA[
require "tprint"
require "pluginhelper"
function portal_handle(name, line, wildcards)
  res, gmcparg = CallPlugin("3e7dedbe37e44942dd46d264","gmcpval","room") --- We just want the gmcp.char section.
  luastmt = "gmcpdata = " .. gmcparg --- Convert the serialized string back into a lua table.
  assert (loadstring (luastmt or "")) ()
  if (GetTimerInfo("portaldel", 1)~= nil) then
    portaldel()
  end
  DeleteTimer('portaldel')
  Send('c beacon')
  if wildcards[1] ~= '' then
    print('here')
    if tonumber(wildcards[1] == nil) then
      print('Try homePortal <number>')
      return
    end
    Execute ('mapper fullportal {c homecom} {'..tonumber(wildcards[1])..'} 0')
  else
    Execute ('mapper fullportal {c homecom} {'..gmcpdata.info.num..'} 0')
  end
  AddTimer ( 'portaldel' , 2 , 15 , 0 , 'echo deleting temp portal' , 1029 , 'portaldel' )
end
function portaldel()
  Execute('mapper delete portal c homecom')
end
function portaldelpet()
  Execute('mapper delete portal c door')
end
function portal_handle_pet(name, line, wildcards)
  res, gmcparg = CallPlugin("3e7dedbe37e44942dd46d264","gmcpval","room") --- We just want the gmcp.char section.
  luastmt = "gmcpdata = " .. gmcparg --- Convert the serialized string back into a lua table.
  assert (loadstring (luastmt or "")) ()
  if (GetTimerInfo("portaldel", 1)~= nil) then
    portaldelpet()
  end
  
  Send('order '..wildcards[1]..' sit')
  Execute ('mapper fullportal {c door '..wildcards[1]..'} {'..gmcpdata.info.num..'} 0')
end
function do_Execute_no_echo(command)
  local original_echo_setting = GetOption("display_my_input")
  SetOption("display_my_input", 0)
  Execute(command)
  SetOption("display_my_input", original_echo_setting)
end
function clearPortals()
  Execute('mapper delete portal c homecom')
  Execute('mapper delete portal c door')
end
function clearPortalHome()
  DeleteTimer('portaldel')
  Execute('mapper delete portal c homecom')
end
function clearPortalPet()
  Execute('mapper delete portal c door')
end
function help()
  print ('Commands are:')
  print(' -- homePortal, this can take a room number or leave it out, will autocast beacon of homecomming.')
  print(' -- petPortal, this takes the mob name as "petPortal slobcat"')
  print(' --clearPortals')
  print(' --clearPortalPet')
  print(' --clearPortalHome')
  
end
]]>
</script>


</muclient>
